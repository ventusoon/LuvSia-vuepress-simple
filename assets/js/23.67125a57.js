(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{257:function(t,v,_){"use strict";_.r(v);var e=_(14),r=Object(e.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("blockquote",[v("p",[v("em",[v("strong",[t._v("Internal network port forwarding")])])])]),t._v(" "),v("h1",{attrs:{id:"前言"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),v("ul",[v("li",[v("p",[v("strong",[t._v("在进行好"),v("RouterLink",{attrs:{to:"/posts/ddns/"}},[t._v("上篇")]),t._v("文章的所有操作后，通过远程 "),v("em",[v("code",[t._v("ping")])]),t._v(" 域名，是可以 "),v("em",[v("code",[t._v("ping")])]),t._v(" 通家里的 "),v("em",[v("code",[t._v("IPv4")])]),t._v(" 地址的，但不知为何，通过域名+端口进行远程访问，是失败的，这说明很有可能是端口没有映射成功，于是我又 "),v("a",{attrs:{href:"https://tool.chinaz.com/port",target:"_blank",rel:"noopener noreferrer"}},[v("em",[v("code",[t._v("ping")])]),v("OutboundLink")],1),t._v(" 了下端口，果然，状态显示是关闭了的。")],1)]),t._v(" "),v("p",[v("img",{attrs:{src:"/images/port-forwarding/1.png",alt:"1",title:":smirk:"}})])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("来到主路由上的设置，可以看到这是我对 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 这个设备进行了端口映射，以及设置为 "),v("em",[v("code",[t._v("DMZ")])]),t._v(" 主机。网上很多人说只要设置了 "),v("em",[v("code",[t._v("DMZ")])]),t._v(" 主机，是可以不用设置端口映射的，经我测试，我这里的设备是行不通的，所以我依然进行了端口映射到 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 。")])])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("其实在设置 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 为端口映射的设备之前，我一直映射的是台式主机的内网地址。我的思路是，既然要在电脑上使用 "),v("em",[v("code",[t._v("stable-diffusion-webui")])]),t._v(" ，那我肯定只需要映射外网端口到电脑主机的内网端口就行了，事实证明，由于我家里网络的复杂程度，这种思路是完全错误的，这也是导致了我频繁映射失败，而无法访问内网的直接原因，因为我跳过了电脑主机网关是 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 这一情况。所以当我把映射设备改成 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 后，一下就成功了。（当然， "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 上也必须要对端口进行映射，映射到电脑主机的内网地址）")])])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("综上，因为我自己大脑宕机，花了超过24个小时的时间来研究内网穿透，实际上就是一个小小的思路上的错误而导致的，这也是为什么我给标题的“复杂”二字加了引号。")])]),t._v(" "),v("p",[v("img",{attrs:{src:"/images/port-forwarding/2.png",alt:"2",title:":smirk:"}})]),t._v(" "),v("p",[v("img",{attrs:{src:"/images/port-forwarding/3.png",alt:"2",title:":smirk:"}})])])]),t._v(" "),v("h1",{attrs:{id:"端口映射"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#端口映射"}},[t._v("#")]),t._v(" 端口映射")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("服务名称")]),t._v(" "),v("th",[t._v("设备IP")]),t._v(" "),v("th"),t._v(" "),v("th",[t._v("外部端口(主机)")]),t._v(" "),v("th",[t._v("内部端口（主路由）")]),t._v(" "),v("th",[t._v("外部端口（主路由）")])])]),t._v(" "),v("tbody",[v("tr",[v("td"),t._v(" "),v("td"),t._v(" "),v("td",[t._v("内部端口(主机)")]),t._v(" "),v("td",[t._v("内部端口（openWRT）")]),t._v(" "),v("td",[t._v("外部端口（openWRT）")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("RDP")]),t._v(" "),v("td",[t._v("192.168.123.110")]),t._v(" "),v("td",[t._v("3389")]),t._v(" "),v("td",[t._v("3389")]),t._v(" "),v("td",[t._v("3389")]),t._v(" "),v("td",[t._v("3389")])]),t._v(" "),v("tr",[v("td",[t._v("Alist")]),t._v(" "),v("td",[t._v("192.168.123.110")]),t._v(" "),v("td",[t._v("5244")]),t._v(" "),v("td",[t._v("5244")]),t._v(" "),v("td",[t._v("5244")]),t._v(" "),v("td",[t._v("5244")])]),t._v(" "),v("tr",[v("td",[t._v("SSH")]),t._v(" "),v("td",[t._v("192.168.123.110")]),t._v(" "),v("td",[t._v("22")]),t._v(" "),v("td",[t._v("2121")]),t._v(" "),v("td",[t._v("2121")]),t._v(" "),v("td",[t._v("2121")])]),t._v(" "),v("tr",[v("td",[t._v("openWRT")]),t._v(" "),v("td",[t._v("192.168.123.3")]),t._v(" "),v("td",[t._v("80")]),t._v(" "),v("td",[t._v("22513")]),t._v(" "),v("td",[t._v("22513")]),t._v(" "),v("td",[t._v("22513")])])])]),t._v(" "),v("ul",[v("li",[v("strong",[t._v("可以看到，由于我家里的网络布局，对端口进行了两次映射，先把最外面的主路由端口映射到 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 上，再把第二层设备 "),v("em",[v("code",[t._v("openWRT")])]),t._v(" 端口映射到主机上，如此就形成了完整的端口映射方案，这下再避开一些电信封禁的端口，是可以完美访问内网设备的。")])])]),t._v(" "),v("h1",{attrs:{id:"域名访问"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#域名访问"}},[t._v("#")]),t._v(" 域名访问")]),t._v(" "),v("ul",[v("li",[v("p",[v("strong",[t._v("按理说，我在"),v("RouterLink",{attrs:{to:"/posts/ddns/"}},[t._v("上篇")]),t._v("文章的 "),v("em",[v("code",[t._v("ddns-go")])]),t._v(" 中添加了域名， "),v("em",[v("code",[t._v("web")])]),t._v(" 服务是可以直接通过域名+端口的形式访问的，但是此时会跳转错误。通过分析，其实也不难得出答案，访问 "),v("em",[v("code",[t._v("web")])]),t._v(" 服务时，因为域名要占用80端口，但是80端口又是被封禁了，所以是无法用此方法的。")],1)])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("来到宝塔面板，添加站点，输入域名+已经映射完成的端口号，访问成功")])]),t._v(" "),v("p",[v("img",{attrs:{src:"/images/port-forwarding/4.png",alt:"4",title:":smirk:"}}),t._v(" "),v("img",{attrs:{src:"/images/port-forwarding/5.png",alt:"5",title:":smirk:"}})])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("访问网页时，即使加上了 "),v("em",[v("code",[t._v("SSL")])]),t._v(" 也是显示的“不安全”，从研究服务器这么久可以知道，访问内网实际上是一样的，加上 "),v("em",[v("code",[t._v("SSL")])]),t._v(" 是可以成功的。这里一直没有搞懂原因，还是闲下来再测试和折腾吧。。。")])])])])])}),[],!1,null,null,null);v.default=r.exports}}]);